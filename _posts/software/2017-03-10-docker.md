---
layout: post
title:  "Docker"
date:   2017-03-10 06:30:00
categories: software
---

* TOC
{:toc}

## 1. Installation

On Centos check SELinux with `sestatus` and do `setenforce 0`

```bash
curl -sSL https://get.docker.com | sh
sudo usermod -aG docker andre
# 
# new repo was added...
#
$ cat /etc/apt/sources.list.d/docker.list 
deb [arch=amd64] https://apt.dockerproject.org/repo debian-jessie main
```

## 2. First Steps

### Basics

Hello World:

```bash
docker run debian echo hello world
```

Start Bash in container and attach:

```bash
docker run -it debian bash
root@02156d24da81:/#
```

Show containers:

```bash
docker ps -a
CONTAINER ID        IMAGE               COMMAND              CREATED              STATUS                     PORTS               NAMES
02156d24da81        debian              "/bin/bash"          About a minute ago   Exited (0) 6 seconds ago                       practical_kilby
574cd4f977f4        debian              "echo hello world"   5 minutes ago        Exited (0) 5 minutes ago                       stupefied_bartik
```

Filter inspect json with Go template

```bash
docker inspect --format {{.NetworkSettings.IPAddress}} awesome_swartz 
172.17.0.2
```

Show file system diff:

```bash
docker diff awesome_swartz 
A /test
C /bin
D /bin/echo
```

Show logs:

```bash
docker logs awesome_swartz 
root@99c4fcfc87bf:/# rm /bin/echo 
root@99c4fcfc87bf:/# touch test
```

Delete container:
```bash
docker rm awesome_swartz
```

Delete all exited containers:
```bash
docker rm -v $(docker ps -aq -f status=exited)
```

Check Union File System:
```bash
docker info | grep Storage
# Storage Driver: overlay2
```

### Redis Example

Get official redis image from the library:
```bash
docker pull redis
```

Start redis container like a daemon with -d :
```bash
docker run --name myredis -d redis
```

Start a second container for running redis-cli. The --link creates an /etc/hosts entry for myredis:
```bash
docker run --rm -it --link myredis redis /bin/bash
root@14f64e1dcf91:/data# redis-cli -h myredis
myredis:6379> ping
PONG
myredis:6379> set key 1234
OK
myredis:6379> save
OK
```

In the official redis Dockerfile there is `VOLUME /data`. With another container, importing the myredis /data volume + mounting a backup volumes, we can create a backup of this data:
```bash
mkdir backup
docker run --rm --volumes-from myredis -v $(pwd)/backup:/backup debian cp /data/dump.rdb /backup/
ls backup
```
